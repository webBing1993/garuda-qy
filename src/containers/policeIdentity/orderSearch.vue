<template>  <div>    <div class="orderTitle">      <span @click="syncTime">同步</span>      <span>        <x-input  placeholder="请输入手机号或姓名拼音" v-model="searchOrder">        <i slot="label" style="padding-right:10px;display:block;" class="iconfont icon-sousuo" width="24" height="24"></i>        </x-input>      </span>    </div>    <div v-for="(item,index) in resultList" class="wrap" @click="chooseOrder(item)">      <div>        <span class="item">订单号：</span>        <span>{{item.order_pmsid}}</span>        <span style="float:right;color:#2c5fc3 ">{{item.precheckin_status==1?'未确认':item.payinfo.pay_mode==1?'现付房费':'不需现付房费'}}<i v-if="item.precheckin_status==6" class="iconfont icon-huodongbiaoqian"></i></span></div>      <div class="line"></div>      <div>        <span class="item">预定人：</span>        <span>{{item.owner}}</span>        <span style="margin-left: 1rem">{{item.owner_tel}}</span>      </div>      <div>        <span class="item" style="vertical-align: top">房型：</span>        <span class="ItemValue">         <span style="margin-right: 1rem" v-for="room in item.rooms_plan">{{room.room_type}}X{{room.room_count}}</span>        </span>      </div>      <!--<div>-->        <!--<span class="item">预付款：</span>-->        <!--<span>¥{{item.payinfo.pms_pay*1000}}</span>-->      <!--</div>-->      <div>        <span class="item">入住：</span>        <span>{{datetimeparse(item.in_time,'YYMMDD')}}</span>        <span style="margin-left: 1rem;color: #959595">离店：</span><span>{{datetimeparse(item.out_time,'YYMMDD')}}</span><span style="margin-left: 1rem">{{item|filterStayDay}}</span>      </div>      <div class="line"></div>      <div>        <span class="item">备注：</span>        <span>{{item.remark}}</span>      </div>    </div>  </div></template><script>    import {mapActions,mapState,mapMutations} from 'vuex'    import {Cell,XInput} from 'vux'    export default {        components:{            XInput        },        data(){            return{                // list:[{order_id:5575658,owner_tel:1844241212,owner:'郑24斯洁',rooms_plan:[{room_type:"大床房", room_count:2}],payinfo:{pms_pay:76},in_time:1536742363523,out_time:1534235227527,remark:''},{order_id:5575658,owner_tel:1873632824,rooms_plan:[{room_type:"普通房", room_count:5,},{room_type:"标准房", room_count:1}],owner:'汪大23婷',payinfo:{pms_pay:76},in_time:1536742363523,out_time:1534235227527,remark:''},{order_id:5575658,owner_tel:18335469343,owner:'孙书jing',rooms_plan:[{room_type:"温馨圆房", room_count:3,},{room_type:"大床房", room_count:2},{room_type:"温馨圆房", room_count:3,},{room_type:"大床房", room_count:2},{room_type:"温馨圆房", room_count:3,},{room_type:"大床房", room_count:2}],payinfo:{pms_pay:76},in_time:1536742363523,out_time:1534235227527,remark:''}],                orderList:[],                searchOrder:'',                resultList:[],            }        },        filters:{            filterPayMode(val){                if(val==3){                    return '后付\挂账'                }else if(val==2){                    return '预付'                }else{                    return '其他'                }            },            filterStayDay(val){                return Math.ceil((val.out_time-val.in_time)/3600000/24)+'晚'            }        },        methods:{            ...mapActions([                'goto',                'replaceto',                'getAllOrderList',                'searchOrderList',                'hotelrefresh'            ]),            ...mapMutations([                'CHECKORDERITEM'            ]),            syncTime(){                this.hotelrefresh({                    onsuccess: (body) => this.getAllOrderLists()                })            },            //选择一个订单            chooseOrder(item){                this.searchOrderList({                    data:{                        "order_id":item.order_id,                        "hotel_id":this.hotel.hotel_id,//酒店ID,初始查询必给                        "idcard_no":'',//身份证号，初始查询必给                        "idcard_name":'',//身份证姓名，初始查询必给                        "room_no":'',//房间号                        "status":"",//订单状态                        "like_info":""//姓名拼音或者手机号                    },                    onsuccess:(body=>{                        if(body.data.length!==0){                            this.CHECKORDERITEM(body.data)                            this.goto(-1);                        }                    })                })            },            getAllOrderLists(){                this.getAllOrderList({                    onsuccess:body=>{                        let list=body.data;                        list.forEach(item=>{                            if(typeof item.ownerPinYing == 'undefined'){                                this.$set(item,'ownerPinYing','');                            }                            item.ownerPinYing=this.pinYing.pinyinConvert(item.owner);                        })                        this.orderList=list;                        // console.log('改变后this.orderList:',this.orderList)                        this.resultList=this.orderList;                    }                });            }        },        computed:{            ...mapState([                'route',                'Interface',                'hotel'            ]),            // pinYingList(){            //     this.orderList.forEach(item=>{            //         pinYing.pinyinConvert(item.)            //     })            // }            // renderList(){            //     // console.log('this.resultList:',this.resultList)            //    return this.resultList;            // },        },        watch:{            searchOrder(val,old) {                // console.log(old)                // console.log(val)                if (val=='') {                    this.resultList =this.orderList;                    // this.isErrorNumber = false;                }                // if (!this.canSearch) return;                if (val && val.split('').some(i => !/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/.test(i))) {//验证特殊字符                    console.log('特殊字符')                    this.searchOrder = old;                    // this.resultList = [];                }                if (val) {                    // this.resultList = [];                    this.resultList = this.orderList.filter(item=> {                        // console.log(item.ownerPinYing.indexOf(val))                        return item.owner_tel.toString ().indexOf (val) > -1 || item.owner.indexOf (val) > -1||item.ownerPinYing.indexOf(val) > -1                    });                    }                }        },        mounted(){           this.getAllOrderLists();        }    }</script><style lang="less" scoped>  @import 'orderSearch.less';</style>