<template>  <div class="hotelBasicInfo">    <group gutter="0">      <selector title="设备类型" v-model="deviceType":options="arealist" direction="rtl" placeholder='请选择设备类型' placeholder-align="right" text-align="right"></selector>      <x-input title="设备名称" v-model="deviceName" placeholder='请输入设备名称' placeholder-align="right" text-align="right"></x-input>      <cell title="设备序列号" v-model="macAddress" placeholder-align="right" text-align="right" @click.native="scanQRcode">        <i slot="default"  class="iconfont icon-erweima"></i>      </cell>      <!--<x-input title="设备序列号" v-model="deviceSn" placeholder-align="right" text-align="right" @click.native="scanQRcode">-->        <!--<i slot="default"  class="iconfont icon-erweima"></i>-->      <!--</x-input>-->      <x-input title="电脑MAC地址" v-model="macAddress" placeholder='接受信息电脑MAC地址' placeholder-align="right" text-align="right"></x-input>    </group>    <p class="bottonGroup" @click="conFirm">确定</p>  </div></template><!--<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>--><script>    import { XInput,XSwitch,Selector,Cell,Group} from 'vux';    import { mapActions,mapState} from 'vuex';    export default {        components: {            XInput,            XSwitch,            Selector,            Cell,            Group        },        data(){            return{                arealist:[{key: '31', value: '底座'}, {key: '41', value: '广告机'}],                deviceType:'',                deviceName:'',                deviceSn:'',                macAddress:''            }        },        computed:{            ...mapState([                'searchHotelId'            ])        },        methods:{            ...mapActions([                'addDevice',                'goto',                'getJsApiTicket'            ]),            back(){            },            conFirm(){                this.addDevice({                    data:{                        "hotelId":this.searchHotelId,  //酒店ID                        "deviceType":this.deviceType,  //设备类型                        "deviceName":this.deviceName,  //设备名称                        "deviceId":this.deviceSn, // 设备sn 号                        "macAddress":this.macAddress //mac 地址                    },                    onsuccess:body=>{                        this.goto('/onlineTool/onlineDetail')                    }                })            },            scanQRcode(){                console.log(location.href.split('#')[0])                let url=location.href.split('#')[0];                let timestamp = Date.parse(new Date());                let nonceStr = Math.random().toString(36).substr(2);                let jsapi_ticket = "";                this.getJsApiTicket({                    onsuccess:body=>{                        console.log('jsApi:',body.data)                        jsapi_ticket=body.data;                        var s = "jsapi_ticket=" + jsapi_ticket + "&noncestr=" + nonceStr + "&timestamp=" + timestamp + "&url="+url;                        var signature=this.hex_sha1(s);                        console.log('str:',signature);                        wx.config({                            beta: true,// 必须这么写，否则wx.invoke调用形式的jsapi会有问题                            debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。                            appId: 'wxab71a595d1896860', // 必填，企业微信的corpID                            timestamp: timestamp, // 必填，生成签名的时间戳                            nonceStr: nonceStr, // 必填，生成签名的随机串                            signature: signature,// 必填，签名，见附录1                            jsApiList: ['scanQRCode'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2                        });                        wx.error(function(res){                            // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。                            console.log('resZsj:',res)                        });                        wx.scanQRCode({                            desc: 'scanQRCode desc',                            needResult: 1, // 默认为0，扫描结果由企业微信处理，1则直接返回扫描结果，                            scanType: ["qrCode", "barCode"], // 可以指定扫二维码还是一维码，默认二者都有["qrCode", "barCode"]                            success: function(res) {                                this.deviceSn=res                                console.log('resss:',res)                                // 回调                            },                            error: function(res) {                                console.log('errorRes:',res)                                if (res.errMsg.indexOf('function_not_exist') > 0) {                                    alert('版本过低请升级')                                }                            }                        });                    }                });            },            hex_sha1(str){                var hexcase = 0;                var chrsz = 8;                function sha1_ft(t, b, c, d) {                    if (t < 20)                        return (b & c) | ((~b) & d);                    if (t < 40)                        return b ^ c ^ d;                    if (t < 60)                        return (b & c) | (b & d) | (c & d);                    return b ^ c ^ d; // t<80                }                function rol(num, cnt) {                    return (num << cnt) | (num >>> (32 - cnt));                }                function AlignSHA1(str) {                    var nblk = ((str.length + 8) >> 6) + 1,                        blks = new Array(nblk * 16);                    for (var i = 0; i < nblk * 16; i++)                        blks[i] = 0;                    for (i = 0; i < str.length; i++)                        blks[i >> 2] |= str.charCodeAt(i) << (24 - (i & 3) * 8);                    blks[i >> 2] |= 0x80 << (24 - (i & 3) * 8);                    blks[nblk * 16 - 1] = str.length * 8;                    return blks;                }                function binb2hex(binarray) {                    var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";                    var str = "";                    for (var i = 0; i < binarray.length * 4; i++) {                        str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +                            hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);                    }                    return str;                }                function safe_add(x, y) {                    var lsw = (x & 0xFFFF) + (y & 0xFFFF);                    var msw = (x >> 16) + (y >> 16) + (lsw >> 16);                    return (msw << 16) | (lsw & 0xFFFF);                }                function sha1_kt(t) {                    return (t < 20) ? 1518500249 : (t < 40) ? 1859775393 : (t < 60) ? -1894007588 : -899497514;                }                function core_sha1(blockArray) {                    var x = blockArray; // append padding                    var w = Array(80);                    var a = 1732584193;                    var b = -271733879;                    var c = -1732584194;                    var d = 271733878;                    var e = -1009589776;                    for (var i = 0; i < x.length; i += 16) // 每次处理512位 16*32                    {                        var olda = a;                        var oldb = b;                        var oldc = c;                        var oldd = d;                        var olde = e;                        for (var j = 0; j < 80; j++) // 对每个512位进行80步操作                        {                            if (j < 16)                                w[j] = x[i + j];                            else                                w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);                            var t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));                            e = d;                            d = c;                            c = rol(b, 30);                            b = a;                            a = t;                        }                        a = safe_add(a, olda);                        b = safe_add(b, oldb);                        c = safe_add(c, oldc);                        d = safe_add(d, oldd);                        e = safe_add(e, olde);                    }                    return new Array(a, b, c, d, e);                }                return binb2hex(core_sha1(AlignSHA1(str)))            },            // aaa(){            //     function bbb () {            //         var ss=742424            //         return ss            //     }            //     console.log(bbb())            // }        },        mounted(){          // this.aaa();        }    }</script><style lang="less" scoped>  @import './index.less';  .icon-erweima{    color: #4660c7;  }</style>